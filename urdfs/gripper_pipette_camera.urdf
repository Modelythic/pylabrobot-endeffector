<?xml version="1.0"?>
<robot name="gripper_with_pipette">

  <!-- ====================== -->
  <!-- FOUR FINGER GRIPPER BASE -->
  <!-- ====================== -->
  
  <!-- Base link (cylindrical end effector) -->
  <link name="gripper_base_link">
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.05"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.05"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.5"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>

  <!-- Palm link (gripper mounting plate at bottom of cylinder) -->
  <link name="palm_link">
    <visual>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.01"/>
      </geometry>
      <material name="dark_gray">
        <color rgba="0.3 0.3 0.3 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.04" length="0.01"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <mass value="0.2"/>
      <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
    </inertial>
  </link>

  <!-- Fixed joint connecting palm to base -->
  <joint name="base_to_palm" type="fixed">
    <parent link="gripper_base_link"/>
    <child link="palm_link"/>
    <origin xyz="0 0 -0.025" rpy="0 0 0"/>
  </joint>

  <!-- ===================================== -->
  <!-- CAMERA LENS (CENTER CYLINDER)         -->
  <!-- ===================================== -->
  <!-- 10mm diameter, 20mm long black cylinder for camera lens -->
  <link name="camera_lens">
    <visual>
      <origin xyz="0 0 -0.01" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.005" length="0.020"/>
      </geometry>
      <material name="black">
        <color rgba="0.1 0.1 0.1 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.01" rpy="0 0 0"/>
      <geometry>
        <cylinder radius="0.005" length="0.020"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.01" rpy="0 0 0"/>
      <mass value="0.05"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="palm_to_camera" type="fixed">
    <parent link="palm_link"/>
    <child link="camera_lens"/>
    <!-- Camera extends downward from palm, centered -->
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- Finger 1 (0 degrees - positive X direction) - MASTER JOINT -->
  <link name="finger1_link">
    <visual>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.1"/>
      </geometry>
      <material name="blue">
        <color rgba="0.2 0.4 0.8 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.01"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
    </inertial>
  </link>

  <joint name="finger1_joint" type="prismatic">
    <parent link="palm_link"/>
    <child link="finger1_link"/>
    <origin xyz="0.007 0 -0.01" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="0" upper="0.03" effort="100" velocity="0.1"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <!-- Finger 2 (90 degrees - positive Y direction) -->
  <link name="finger2_link">
    <visual>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.1"/>
      </geometry>
      <material name="blue">
        <color rgba="0.2 0.4 0.8 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.01"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
    </inertial>
  </link>

  <joint name="finger2_joint" type="prismatic">
    <parent link="palm_link"/>
    <child link="finger2_link"/>
    <origin xyz="0 0.007 -0.01" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="0.03" effort="100" velocity="0.1"/>
    <dynamics damping="0.1" friction="0.1"/>
    <mimic joint="finger1_joint" multiplier="1" offset="0"/>
  </joint>

  <!-- Finger 3 (180 degrees - negative X direction) -->
  <link name="finger3_link">
    <visual>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.1"/>
      </geometry>
      <material name="blue">
        <color rgba="0.2 0.4 0.8 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.01"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
    </inertial>
  </link>

  <joint name="finger3_joint" type="prismatic">
    <parent link="palm_link"/>
    <child link="finger3_link"/>
    <origin xyz="-0.007 0 -0.01" rpy="0 0 0"/>
    <axis xyz="-1 0 0"/>
    <limit lower="0" upper="0.03" effort="100" velocity="0.1"/>
    <dynamics damping="0.1" friction="0.1"/>
    <mimic joint="finger1_joint" multiplier="1" offset="0"/>
  </joint>

  <!-- Finger 4 (270 degrees - negative Y direction) -->
  <link name="finger4_link">
    <visual>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.1"/>
      </geometry>
      <material name="blue">
        <color rgba="0.2 0.4 0.8 1"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <geometry>
        <box size="0.003 0.003 0.01"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 -0.005" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
    </inertial>
  </link>

  <joint name="finger4_joint" type="prismatic">
    <parent link="palm_link"/>
    <child link="finger4_link"/>
    <origin xyz="0 -0.007 -0.01" rpy="0 0 0"/>
    <axis xyz="0 -1 0"/>
    <limit lower="0" upper="0.03" effort="100" velocity="0.1"/>
    <dynamics damping="0.1" friction="0.1"/>
    <mimic joint="finger1_joint" multiplier="1" offset="0"/>
  </joint>

  <!-- ====================== -->
  <!-- PIPETTE HEAD SYSTEM -->
  <!-- ====================== -->
  <!-- Mounted to outer perimeter of gripper cylinder -->
  
  <!-- FIXED BASE MOUNT PLATE -->
  <link name="pipette_base_link">
    <visual>
      <geometry>
        <box size="0.08 0.08 0.01"/>
      </geometry>
      <material name="pipette_gray">
        <color rgba="0.5 0.5 0.5 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.08 0.08 0.01"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
    </inertial>
  </link>

  <!-- Mount pipette base to outer perimeter of gripper cylinder -->
  <joint name="gripper_to_pipette" type="fixed">
    <parent link="gripper_base_link"/>
    <child link="pipette_base_link"/>
    <!-- Position at radius 0.04m on the perimeter, oriented so syringe tip faces downward
         The pipette extends downward from the cylinder, aligned with gripper fingers
         Rotated 90 degrees around Z-axis -->
    <origin xyz="0.04 0 0.1" rpy="0 0 1.5708"/>
  </joint>

  <!-- Z-AXIS L12 ACTUATOR BODY  -->
  <link name="z_actuator_body">
    <visual>
      <geometry>
        <!-- L12 body: rectangular cross-section 10mm x 15mm, motor section ~52mm -->
        <box size="0.010 0.015 0.052"/>
      </geometry>
      <material name="black">
        <color rgba="0.1 0.1 0.1 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.010 0.015 0.052"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.056"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="pipette_base_to_z_actuator" type="fixed">
    <parent link="pipette_base_link"/>
    <child link="z_actuator_body"/>
    <!-- Mount actuator body below base plate, oriented downward (negative Z) -->
    <origin xyz="0 0 -0.031" rpy="0 0 0"/>
  </joint>

  <!-- Z-AXIS MOVING SHAFT -->
  <link name="z_actuator_shaft">
    <visual>
      <geometry>
        <!-- 9mm diameter shaft -->
        <cylinder radius="0.0045" length="0.100"/>
      </geometry>
      <material name="silver">
        <color rgba="0.7 0.7 0.7 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.0045" length="0.100"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.010"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="z_axis_joint" type="prismatic">
    <parent link="z_actuator_body"/>
    <child link="z_actuator_shaft"/>
    <!-- Shaft extends downward (negative Z direction) -->
    <origin xyz="0 0 -0.076" rpy="0 0 0"/>
    <axis xyz="0 0 -1"/>
    <limit lower="0.0" upper="0.100" effort="80" velocity="0.0065"/>
  </joint>

  <!-- PIPETTE MOUNTING BRACKET/CLEVIS  -->
  <link name="pipette_mount">
    <visual>
      <geometry>
        <box size="0.025 0.025 0.015"/>
      </geometry>
      <material name="pipette_blue">
        <color rgba="0.2 0.4 0.8 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.025 0.025 0.015"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.015"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="z_shaft_to_mount" type="fixed">
    <parent link="z_actuator_shaft"/>
    <child link="pipette_mount"/>
    <origin xyz="0 0 -0.0575" rpy="0 0 0"/>
  </joint>

  <!-- SYRINGE PUMP L12 ACTUATOR BODY -->
  <link name="syringe_actuator_body">
    <visual>
      <geometry>
        <box size="0.010 0.015 0.052"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.010 0.015 0.052"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.056"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="mount_to_syringe_actuator" type="fixed">
    <parent link="pipette_mount"/>
    <child link="syringe_actuator_body"/>
    <!-- Actuator mounted inverted, extends upward -->
    <origin xyz="0.020 0 0.033" rpy="0 0 0"/>
  </joint>

  <!-- SYRINGE PUMP ACTUATOR SHAFT -->
  <link name="syringe_actuator_shaft">
    <visual>
      <geometry>
        <cylinder radius="0.0045" length="0.100"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.0045" length="0.100"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.010"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="syringe_pump_joint" type="prismatic">
    <parent link="syringe_actuator_body"/>
    <child link="syringe_actuator_shaft"/>
    <!-- Shaft extends upward (positive Z direction) from inverted actuator -->
    <origin xyz="0 0 0.076" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="0.0" upper="0.100" effort="80" velocity="0.0065"/>
  </joint>

  <!-- SYRINGE BARREL/BODY -->
  <link name="syringe_barrel">
    <visual>
      <geometry>
        <!-- Typical 1mL syringe: ~6.5mm outer diameter, ~60mm barrel length -->
        <cylinder radius="0.00325" length="0.060"/>
      </geometry>
      <material name="transparent">
        <color rgba="0.8 0.8 0.9 0.6"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.00325" length="0.060"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.005"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="mount_to_syringe_barrel" type="fixed">
    <parent link="pipette_mount"/>
    <child link="syringe_barrel"/>
    <!-- Syringe barrel positioned next to mount, extending upward -->
    <origin xyz="0.020 0 0.022" rpy="0 0 0"/>
  </joint>

  <!-- SYRINGE PLUNGER -->
  <link name="syringe_plunger">
    <visual>
      <geometry>
        <!-- Plunger rod: 2mm diameter, length variable with stroke -->
        <cylinder radius="0.001" length="0.080"/>
      </geometry>
      <material name="dark_gray_plunger">
        <color rgba="0.3 0.3 0.3 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.001" length="0.080"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.003"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="plunger_connection" type="fixed">
    <parent link="syringe_actuator_shaft"/>
    <child link="syringe_plunger"/>
    <!-- Plunger rod attached to actuator shaft tip -->
    <origin xyz="0 0 0.090" rpy="0 0 0"/>
  </joint>

  <!-- SYRINGE FLANGE (TOP) -->
  <link name="syringe_flange">
    <visual>
      <geometry>
        <box size="0.015 0.010 0.003"/>
      </geometry>
      <material name="transparent"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.015 0.010 0.003"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.001"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="barrel_to_flange" type="fixed">
    <parent link="syringe_barrel"/>
    <child link="syringe_flange"/>
    <origin xyz="0 0 0.0315" rpy="0 0 0"/>
  </joint>

  <!-- SYRINGE TIP/LUER LOCK -->
  <link name="syringe_tip">
    <visual>
      <geometry>
        <cylinder radius="0.0015" length="0.010"/>
      </geometry>
      <material name="transparent"/>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.0015" length="0.010"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.001"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>

  <joint name="barrel_to_tip" type="fixed">
    <parent link="syringe_barrel"/>
    <child link="syringe_tip"/>
    <origin xyz="0 0 -0.035" rpy="0 0 0"/>
  </joint>

</robot>
